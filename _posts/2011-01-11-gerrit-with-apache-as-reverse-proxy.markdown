--- 
layout: post
name: gerrit-with-apache-as-reverse-proxy
title: Gerrit with Apache as Reverse Proxy
time: 2011-01-11 11:11:00 +01:00
comments: true
---
This is an example how to configure Apache as a Reverse Proxy with SSL and Gerrit:<br /><br />Apache VHost configuration:<br /><br />
<span class="Apple-style-span" style="background-color: #eeeeee;">NameVirtualHost *:443</span><br />
<span class="Apple-style-span" style="background-color: #eeeeee;">&lt;VirtualHost *:443&gt;</span><br />
<span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;ServerName hostname:443</span><br />
<span class="Apple-style-span" style="background-color: #eeeeee;"><br /></span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;SSLEngine on</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;SSLCertificateFile /etc/pki/tls/certs/localhost.crt</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;SSLCertificateKeyFile /etc/pki/tls/private/localhost.key</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;"><br /></span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;ProxyRequests Off</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;ProxyVia Off</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;ProxyPreserveHost On</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;SSLProxyEngine On</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;"><br /></span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;&lt;Proxy *&gt;</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Order deny,allow</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow from all</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;&lt;/Proxy&gt;</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;"><br /></span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp;ProxyPass / http://127.0.0.1:8080/</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;"><br /></span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&lt;/VirtualHost&gt;</span><br /><br />Gerrit configuration (only the relevant parts):<br /><br /><span class="Apple-style-span" style="background-color: #eeeeee;">[gerrit]</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;canonicalWebUrl = https://hostname/</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">[httpd]</span><br /><span class="Apple-style-span" style="background-color: #eeeeee;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;listenUrl = proxy-https://127.0.0.1:8080/</span><br /><br />The canonicalWebUrl stands for the URL under which you want to reach the Gerrit interface. The listenUrl have to be exactly the same as the URL in the ProxyPass directive of the Apache configuration. The prefix proxy-https means, that the SSL handling is done by the Apache and not by Gerrit.
